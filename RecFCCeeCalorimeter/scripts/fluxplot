#!/usr/bin/env python


def main():
    import ROOT
    import math

    ROOT.gROOT.SetBatch(True)

    infile = ROOT.TFile.Open('output_fullCalo_SimAndDigi.root')
    tree = infile.Get('events')

    canvas = ROOT.TCanvas()
    hist_z_r = ROOT.TH2D('hist_z_r',
                         'Number of particles, n, 2 GeV;z [mm];r [mm];N',
                         200, -6.5e3, 6.5e3, 200, 0., 7e3)
    hist_x_y = ROOT.TH2D('hist_x_y',
                         'Number of particles, n, 2 GeV;x [mm];y [mm];N',
                         200, -7e3, 7e3, 200, -7e3, 7e3)
    hist_x_y_pos = ROOT.TH2D('hist_x_y_pos',
                             'Number of particles, n, 2 GeV;x [mm];y [mm];N',
                             200, -7e3, 7e3, 200, -7e3, 7e3)
    hist_z_phi = ROOT.TH2D('hist_z_phi',
                           'Number of particles, n, 2 GeV;z [mm];#phi;N',
                           200, -6.5e3, 6.5e3,
                           200, -(math.pi + 0.1), math.pi + 0.1)
    hist_r = ROOT.TH1D('hist_r',
                       'Number of particles, n, 2 GeV;r [mm];N',
                       200, 0., 0.)

    for i, event in enumerate(tree):
        if i % 100 == 0:
            print('event:', i)
        for hit in event.FluxPositionedHits:
            r = math.sqrt(math.pow(hit.position.x, 2) +
                          math.pow(hit.position.y, 2))
            # print("r = ", r)
            # print("z = ", hit.position.z)
            # theta = math.atan(r / hit.position.z)
            phi = math.acos(hit.position.x / r)
            if (hit.position.y < 0):
                phi *= -1

            hist_z_r.Fill(hit.position.z, r)
            hist_x_y.Fill(hit.position.x, hit.position.y)
            if (hit.position.z > 0):
                hist_x_y_pos.Fill(hit.position.x, hit.position.y)
            hist_z_phi.Fill(hit.position.z, phi)
            hist_r.Fill(r)

    hist_x_y.Draw('COLZ')
    canvas.Print('hits_x_y.pdf')
    hist_x_y_pos.Draw('COLZ')
    canvas.Print('hits_pos_x_y.pdf')
    hist_z_r.Draw('COLZ')
    canvas.Print('hits_z_r.pdf')
    hist_z_phi.Draw('COLZ')
    canvas.Print('hits_z_phi.pdf')
    hist_r.Draw('')
    canvas.Print('hits_r.pdf')

if __name__ == '__main__':
    main()
